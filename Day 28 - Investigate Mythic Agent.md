### 1. Introduction

**Goal:** Understand how to investigate activity generated by the Mythic C2 framework and identify key indicators of compromise. Focus on correlating process, network, and file events to map a C2 session.

---

### 2. Accessing Events

- Navigate to the Discover section, set the time frame to 30 days and search for the Mythic C2 agent executable `svchost-emaan.exe`.
- Sorting events from old to new helped follow the sequence of activities generated by the agent.
- The events included both process creations and network connections, giving insight into the C2’s operational timeline. We can check the dashboards we created in day 22.

<img width="1100" height="138" alt="image" src="https://github.com/user-attachments/assets/2e4f41b1-49e5-45c2-827d-5392cd8fa5df" />


- Table shows suspicious **PowerShell activities**.
- Agent name isn’t obviously suspicious, but behavior is unusual.
- Executable running from **Public Downloads** connecting to an **IP via HTTP** is suspicious and unusual.
- Normally, check IP on **threat intelligence tools**, but it’s our **Mythic server**, so won’t appear as malicious.
- **Three processes** all connected to the same IP (our Mythic server) → red flag.

Key starting points for investigation: **suspicious executable** + **destination IP**.

---

### 3. Identifying C2 Activity

- **Network Telemetry:** Multiple back-and-forth connections were observed between the agent and the Mythic server. High byte transfers indicated active command sessions.
    
- **Heartbeat & Process Tracking:** Using Sysmon event ID 3, network creations were correlated with process launches to identify which processes were responsible for C2 communication.
    
- Suspicious processes included PowerShell sessions and executables in unusual directories like `C:\Users\Public\Downloads`.


<img width="580" height="270" alt="image" src="https://github.com/user-attachments/assets/0d722c1c-a984-4443-aeac-721cfa24c25a" />

- Query used: `event.code : 3 and winlog.event_data.DestinationIp : <suspiciousIP>`
- Number of events: 3
- On checking all events, noted that only one has a different process GUID:
<img width="620" height="88" alt="image" src="https://github.com/user-attachments/assets/25937872-4b53-474e-85d5-ea066798526e" />

---
### 4. Event Correlation and Timeline

- Three network connection events to the Mythic server IP were identified.
- First event used to extract `ProcessGUID` → correlate all events from the same PowerShell session.
- File creation event occurred immediately after network connections → confirmed agent deployment.
<img width="835" height="52" alt="image" src="https://github.com/user-attachments/assets/03d4d5a8-5da4-4107-a6b5-13dc58b18dff" />


- Log of an executable file detected by sysmon Event ID 29 (allows extraction of executable hash), followed by a process creation event.
<img width="585" height="310" alt="image" src="https://github.com/user-attachments/assets/09172685-1e61-4d41-a005-f6dd715ba7a5" />

<img width="781" height="98" alt="image" src="https://github.com/user-attachments/assets/b4c6ec9d-59b4-41f1-8535-99b6bf3a50cc" />

- As per the timestamps we can determine the sequence of actions: the file was created →  a network connection was established →  it was detected that the file is an executable→  a process was created
- Parent-child relationships observed between PowerShell sessions and Mythic agent process. We observe that the highlighted ProcessGuid passed to ParentProcessGuid, because from the the same PowerShell session we executed the agent and started another process.


<img width="689" height="542" alt="image" src="https://github.com/user-attachments/assets/51b73b9b-5ac1-46c7-854a-70d9df3a5a0c" />


Thus, from the above **Process Create** log ,these findings suggest that the ParentProcessGuid is **{0475c00b-5adf-66f0-283b-000000000a00}** for the PowerShell session and the child ProcessGuid is **{0475c00b-5d10-66f0-393b-000000000a00}**

<img width="552" height="137" alt="image" src="https://github.com/user-attachments/assets/0bc41bc6-42aa-4a5c-a772-c73452b2dd43" />

We can use the child ProcessGuid to find the **Network connection detected** log as well.

---

### 5. Key Findings

- Mythic C2 agent `svchost-emaan.exe` identified.
- Observed process creations and network connections.
- Suspicious PowerShell activity detected.
- Executable in Public Downloads connecting via HTTP.
- Suspicious IP is **Mythic server**.
- Three processes connected to same IP → red flag.
- Multiple back-and-forth network connections; high byte transfers indicate active commands.
- Suspicious processes in unusual directories.
- Query: `event.code : 3 and winlog.event_data.DestinationIp : <suspiciousIP>` → 3 events found.
- One event had a different ProcessGUID, while the other two had the same one → new session/process.
- Sequence: file created → network connection → executable detected → process created.
- Parent-child relationship: PowerShell session spawned agent; ProcessGuid passed to ParentProcessGuid.
- ParentProcessGuid = `{0475c00b-5adf-66f0-283b-000000000a00}`, child ProcessGuid = `{0475c00b-5d10-66f0-393b-000000000a00}`.

---

### 6. Ticketing Integration

- Mythic agent detection rule configured to push alerts via Webhook to osTicket.
- Click on our Mythic C2 Apollo Detected rule.
-  Click on Edit rule settings, move to actions and choose Webhook. Under the body, we can use the same structure we have been using.
- Save changes.

---

### 7. Detection Rule / SIEM Integration

-Custom detection rule created for `cmd.exe` process creation by non-system users → captures shell commands executed through C2. 
(Query used: `event.code : “1” and winlog.event_data.OriginalFileName: “Cmd.Exe” and not winlog.event_data.ParentUser: “NT AUTHORITY\\SYSTEM” `)

- Severity: Medium, Risk Score: 60, run every minute.
- Alerts pushed via Webhook → osTicket.
- To test the rule, go to Mythic Server and on Callbacks run “shell whoami”. On execution of this command, we receive alerts: 


<img width="855" height="52" alt="image" src="https://github.com/user-attachments/assets/e98e4818-5ae6-4398-abc5-f349e3471ced" />


<img width="769" height="414" alt="image" src="https://github.com/user-attachments/assets/01bce058-6704-42f0-b220-d8ef5c28da68" />




---

### 8. Conclusion

- Mythic C2 activity leaves correlated traces across processes, files, network connections.
- Tracking `ProcessGUID` & parent-child relationships essential for reconstructing command sequences.
- Dashboards simplified identification of suspicious activity.
- Timeline documentation provided clear understanding of agent lifecycle and operational footprint.


**Reference**
https://youtu.be/b11TuDx_CjU?si=0l7G0t4JCNZ-yv5C
