### 1. Introduction

**Goal:** Understand how to investigate activity generated by the Mythic C2 framework and identify key indicators of compromise. Focus on correlating process, network, and file events to map a C2 session.

---

### 2. Accessing Events

- Navigate to the Discover section, set the time frame to 30 days and search for the Mythic C2 agent executable `svchost-emaan.exe`.
- Sorting events from old to new helped follow the sequence of activities generated by the agent.
- The events included both process creations and network connections, giving insight into the C2’s operational timeline. We can check the dashboards we created in day 22.

![[Pasted image 20251020013515.png]]

- Table shows suspicious **PowerShell activities**.
- Agent name isn’t obviously suspicious, but behavior is unusual.
- Executable running from **Public Downloads** connecting to an **IP via HTTP** is suspicious and unusual.
- Normally, check IP on **threat intelligence tools**, but it’s our **Mythic server**, so won’t appear as malicious.
- **Three processes** all connected to the same IP (our Mythic server) → red flag.

Key starting points for investigation: **suspicious executable** + **destination IP**.

---

### 3. Identifying C2 Activity

- **Network Telemetry:** Multiple back-and-forth connections were observed between the agent and the Mythic server. High byte transfers indicated active command sessions.
    
- **Heartbeat & Process Tracking:** Using Sysmon event ID 3, network creations were correlated with process launches to identify which processes were responsible for C2 communication.
    
- Suspicious processes included PowerShell sessions and executables in unusual directories like `C:\Users\Public\Downloads`.


![[Pasted image 20251020014318.png]]
- Query used: `event.code : 3 and winlog.event_data.DestinationIp : <suspiciousIP>`
- Number of events: 3
- On checking all events, noted that only one has a different process GUID:
![[Pasted image 20251020014809.png]]
---
### 4. Event Correlation and Timeline

- Three network connection events to the Mythic server IP were identified.
- First event used to extract `ProcessGUID` → correlate all events from the same PowerShell session.
- File creation events occurred immediately after network connections → confirmed agent deployment.
- Sysmon Event ID 29 → allowed extraction of executable hash.
- Parent-child relationships observed between PowerShell sessions and Mythic agent process → mapped sequence of actions.
- Different `ProcessGUIDs` noted for shell commands via C2 → each command spawned a new console session.

---

### 5. Key Findings

- Credential reads and discovery commands consistently logged during C2 activity.
- Windows Defender disabled during activity window → AV bypass attempts.
- Network connections established to Mythic server on standard HTTP ports → exfiltration/command channel confirmed.
- File creation logs confirmed agent binary deployment.
- ParentProcessGuid & ProcessGUID correlations provided clear timeline for sessions and commands.

---

### 6. Alerting and Ticketing Integration

- Mythic agent detection rule configured to push alerts via Webhook to osTicket.
- Custom detection rule for `cmd.exe` process creation by non-system users → captures shell commands executed through C2.
- Alerts include process name, user, timestamp → easier triage.
- Testing: commands like `whoami` via C2 triggered alerts → detection/integration validated.

---

### 7. Investigation Notes / Observations

- Second Mythic agent was still active; ran commands via C2 (`ipconfig`, `dir`, `mkdir Assigments`, `tree`) → generated logs.
- Console opened in `C:\Users\Public\Downloads` → unusual location.
- Dashboard filtering by **Process Initiated Network Connections** showed agent and suspicious PowerShell activity.
- Executable on Public Downloads connecting to IP via HTTP → suspicious.
- Three processes all connected to same IP → red flag.
- Investigation starting points: **suspicious executable** + **destination IP**.
- Query used to find network connections:
    
    `event.code : 3 and winlog.event_data.DestinationIp : <suspiciousIP>`
    
- `ProcessGUID` correlation helped track events across PowerShell session and agent activity.
- Network connection timestamps vs. file creation timestamps → small delays possible due to Elastic ingestion.
- Event ID 29 → executable hash extraction.
- ParentProcessGuid tracking → mapped new processes spawned by agent.
- Shell commands from C2 → each created a new console, different `ProcessGUID` each time.

---

### 8. Detection Rule / SIEM Integration

- Created custom rule for `cmd.exe` process creation by non-system users:
    
    `event.code : “1”  and winlog.event_data.OriginalFileName: “Cmd.Exe”  and not winlog.event_data.ParentUser: “NT AUTHORITY\\SYSTEM”`
    
- Severity: Medium, Risk Score: 60, run every minute.
- Alerts pushed via Webhook → osTicket.
- Test: `shell whoami` → confirmed alert generation.
- Custom highlighted fields added for easier alert review.

---

### 9. Conclusion

- Mythic C2 activity leaves correlated traces across processes, files, network connections.
- Tracking `ProcessGUID` & parent-child relationships essential for reconstructing command sequences.
- Dashboards simplified identification of suspicious activity.
- Timeline documentation provided clear understanding of agent lifecycle and operational footprint.


**Reference**
https://youtu.be/b11TuDx_CjU?si=0l7G0t4JCNZ-yv5C